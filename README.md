# 🛡️ Схема защиты сервера от DDoS-атак с ограниченными ресурсами

**Многоуровневая архитектура фильтрации и защиты, реализуемая с минимальными затратами.**

**Интернет → Cloudflare → Фаервол → Балансировщик → Серверы → База данных → Мониторинг**

---

## 🌐 1. Внешний уровень (Интернет)

**Облачный фильтр: Cloudflare (Free Tier)**  
- 🔒 SSL/TLS-шифрование  
- 🧱 Блокировка вредоносных IP и ботов  
- 🌍 Гео-фильтрация  
- 📦 Кэширование статики  

---

## 🧰 2. Первичная фильтрация (Выделенный сервер №1)

**🧱 Фаервол: iptables/nftables**  
- Ограничение соединений на IP  
- Блокировка подозрительных портов

**🔁 Nginx как Reverse Proxy**  
- Rate limiting  
- Slowloris protection  
- Фильтрация HTTP/HTTPS-запросов  

---

## ⚖️ 3. Балансировка нагрузки (Выделенный сервер №2)

**HAProxy / Keepalived**  
- 📡 Health-check'и  
- 🚦 Перераспределение трафика  
- ❌ Исключение перегруженных нод  

---

## 🖥️ 4. Серверы приложений

- **Fail2ban** — автоматическая блокировка IP  
- **ModSecurity** — фильтрация SQLi, XSS и др.  
- **Ограничения ресурсов** через systemd/docker  

---

## 🗄️ 5. База данных

- 🔐 Только внутренний доступ  
- 🔒 Закрытые внешние порты  
- 💾 Регулярное резервное копирование (`rsync`, `BorgBackup`)  

---

## 📊 6. Мониторинг и анализ

- **Prometheus + Grafana** — нагрузка и активность  
- **Elasticsearch + Kibana** — лог-анализ  
- **Telegram / Email уведомления** — при аномалиях  

---

## ➕ Дополнительные меры

- 🌍 Гео-блокировка через iptables  
- 🤖 Скрипты автоматической защиты (fail2ban + анализ логов)  
- 🔄 Регулярное обновление ПО и патчей  
- 📶 Резервный канал связи  

---

> 🧠 **Важно понимать**: ни одна схема не даёт 100% гарантии, но многоуровневая архитектура помогает отфильтровывать до 95% шумового и вредоносного трафика до того, как он дойдёт до сервера и приложений работающих на нем.

---

## 🧩 Визуальная модель (схема уровней). Текстовая схема в виде ASCII-графики, которая визуализирует защиту от DDoS и фильтрацию трафика:

┌──────────────────────────────┐
│         Интернет             │
└──────────────┬───────────────┘
               ▼
┌──────────────────────────────┐
│  Облачный фильтр             │
│  (Cloudflare Free Tier)       │
│  • Кэширование статики       │
│  • Блокировка ботов/IP       │
│  • Гео-фильтрация            │
└──────────────┬───────────────┘
               ▼
┌──────────────────────────────┐
│  Выделенный сервер №1        │
│  • iptables/nftables         │  ← Блокировка портов
│  • Nginx (reverse proxy)     │  ← Rate Limiting
└──────────────┬───────────────┘
               ▼
┌──────────────────────────────┐
│  Выделенный сервер №2        │
│  • HAProxy/Keepalived        │  ← Балансировка
│  • Health Checks             │
└──────────────┬───────────────┘
               ▼
┌──────────────────────────────┐
│  Серверы приложений          │
│  • Fail2ban                  │  ← Автоблокировка IP
│  • ModSecurity               │  ← Защита от SQLi/XSS
│  • Ограничения CPU/RAM       │
└──────────────┬───────────────┘
               ▼
┌──────────────────────────────┐
│  База данных                 │
│  • Закрытые порты            │
│  • Резервные копии           │
└──────────────┬───────────────┘
               ▼
┌──────────────────────────────┐
│  Мониторинг                  │
│  • Prometheus + Grafana      │  ← Метрики
│  • Elasticsearch + Kibana    │  ← Анализ логов
│  • Оповещения в Telegram     │
└──────────────────────────────┘

════════════════════════════════════
Дополнительные меры:
• Гео-блокировка через iptables
• Скрипты для автоматизации блокировок
• Регулярные обновления ПО
• Резервный канал связи

## Пояснения:

    - 1. Стрелки (▼) показывают направление трафика.

    - 2. Каждый блок — это этап фильтрации или обработки.

    - 3. Серверы №1 и №2 разделены для распределения нагрузки (можно разместить на одной физической машине, если ресурсы ограничены).

    - 4. Мониторинг — отдельный слой для анализа атак и быстрого реагирования.

## Как это работает:

    - 1. Трафик сначала проходит через Cloudflare, где отсекается большая часть ботов и мусорных запросов.

    - 2. На первом сервере фаервол блокирует ненужные порты, а Nginx ограничивает частоту запросов.

    - 3. Балансировщик на втором сервере распределяет оставшийся "чистый" трафик между серверами приложений.

    - 4. На серверах приложений Fail2ban и ModSecurity добавляют дополнительный уровень защиты.

    - 5. База данных изолирована от прямого доступа извне.

    - 6. Мониторинг отслеживает аномалии в режиме реального времени.











